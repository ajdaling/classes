/*
 * Game.cpp
 *
 *  Created on: Apr 10, 2017
 *      Author: aj
 */

#include "Game.h"
#include <fstream>
#include <assert.h>
#include <iostream>
#include <cstdlib>
#include <string>
using namespace std;
namespace caps {

Game::Game() {


}

Game::~Game() {
	// TODO Auto-generated destructor stub
}

void Game::startGame(){
	cout << "loading data" << endl;
	loadCaps();
	prompt();
	prompt();
}

void Game::loadCaps(){
	ifstream in;
	string country;
	string capital;
	in.open("capitals.csv");
	assert(in.is_open());
	while(getline(in,country)){
		getline(in,capital);
		caps_vec.push_back(make_pair(country,capital));
	}
}

void Game::prompt(){
	string country;
	string capital;
	int score;
	//get random country
	int random_index = rand() % caps_vec.size();
	country = caps_vec[random_index].first;
	capital = caps_vec[random_index].second;
	//print country
	cout << "What is the capital of: ";
	cout << country;
	cout << "?" << endl;
	score = getScore(country, capital);
}

int Game::getScore(string country, string capital){
	cout << "The answer is: " << capital << endl; // TODO remove
	cout << "The length is: " << capital.length() << endl;
	int score = 3;
	bool done = false;
	int cap_length = capital.length();
	string ans, hint;

	while(!done && score > 0){
		cin.clear();
		cin.sync();
		getline(cin,ans);
		cout << "Answer is: " << ans << endl;
		cout << "length of answer is: " << ans.length() << endl;
		//check if user asked for hint
		if(ans.compare("hint") == 0){
			switch(score){
			case 3:
				cout << "one point deducted" << endl;
				score--;
				hint = capital.substr(0,int(cap_length/3));
				break;
			case 2:
				cout << "one point deducted" << endl;
				score--;
				hint = capital.substr(0,int(cap_length/2));
				break;
			case 1:
				cout << "One point deducted." << endl;
				score--;
				hint = capital.substr(0,int(cap_length-2));
				break;
			}
			cout << "Hint: " << hint << endl;
		} else if(ans.compare(capital) == 0){
			cout << "Correct! " << endl;
			done = true;
		} else{
			score--;
			if(score > 1){
				cout << "Incorrect. One point deducted." << endl;
				cout << score << " attempts remaining.";
			} else{
				cout << "Incorrect. The capital of " << country << " is " << capital << endl;
				done = true;
			}
		}
	}
	cout << score << " points earned." << endl;
	return(score);
}

} /* namespace caps */
